<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>F´ Flight Software - C/C++ Documentation: docs/v1.5/Tutorials/MathComponent/Tutorial.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">F´ Flight Software - C/C++ Documentation
   &#160;<span id="projectnumber">NASA-v1.6.0</span>
   </div>
   <div id="projectbrief">A framework for building embedded system applications to NASA flight quality standards.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_math_component_2_tutorial_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">docs/v1.5/Tutorials/MathComponent/Tutorial.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_math_component_2_tutorial_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Math Component Tutorial</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;The following example shows the steps to implement a simple pair of components connected by a pair of ports. The first,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;`MathSender`, will invoke the second, `MathReceiver`, via  a `MathOp` port to perform a math operation and return the</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;result via a `MathResult` port.</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;![`Component` Diagram](img/Comp.jpg &quot;Component Pair&quot;)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;All the code in this tutorial can be found in this directory. This code will work if it is copied or reimplemented</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;within the `Ref` directory of F´. This tutorial will walk the user through modifying the Reference app, Ref, to</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;implement the math components.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;## Prerequisites</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;This tutorial requires the user to have some basic skills and have installed F´. The prerequisite skills to understand</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;this tutorial are as follows:</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;1) Working knowledge of Unix; how to navigate in a shell and execute programs</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;2) An understanding of C++, including class declarations and inheritance</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;3) An understanding of how XML is structured</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;Installation can be done by following the installation guide found at: [INSTALL.md](../../INSTALL.md). This guide</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;will walk the user through the installation process and verifying the installation.  In addition, users may wish to</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;follow the [Getting Started Tutorial](../GettingStarted/Tutorial.md) in order to get a feel for the F´ environment and</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;tools.</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;# 1 Component Descriptions</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;This section will cover the components that will be built in this tutorial. Each component may define the commands,</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;events, telemetry channels, and parameters. This section will list commands, events, telemetry channels, and parameters</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;for each component that will be created.</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;## 1.1 MathSender</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;`MathSender` must do the following:</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;### 1.1.1 Commands</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;`MathSender` should implement a `MS_DO_MATH` command. This command will have three arguments:</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;1) A first value in the operation</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;2) A second value in the operation</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;3) An enumerated argument specifying the operation to perform</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;### 1.1.2 Events</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;`MathSender` should emit an event telling that a command was received to perform the operation. It should also emit an event when the result is received back from `MathReceiver`.</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;### 1.1.3 Telemetry Channels</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;MathSender should have four channels:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;1) The first value</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;2) The second value</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;3) The operation</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;4) The result</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;### 1.1.4 Parameters</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;MathSender will have no parameters.</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;`MathSender` should be an active (i.e. threaded) component, so it will process the commands immediately. The command will be *asynchronous*, which means the handler will be executed on the thread of the active component. It will delegate the operation to `MathReceiver`.</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;## 1.2 MathReceiver </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;`MathReceiver` will be a queued component that performs the requested operation and returns the result. `MathReceiver` will be connected to the 1Hz rate group that is part of the reference example. The simple operation in this component could have just as easily been done in a passive or active component; it is done here as a queued component to illustrate how to implement one.</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;### 1.2.1 Commands</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;`MathReceiver` should implement a MR_SET_FACTOR1 command. This command will set a factor used for any subsequent operations. The result of the commanded operation will be multipled by this factor. It should default to 0 if the command is never invoked.</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;`MathReceiver` should also implement a MR_CLEAR_EVENT_THROTTLE command to clear the throttled MR_SET_FACTOR1 event (see below).</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;### 1.2.2 Events</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;`MathReceiver` should have the following events:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;1) MR_SET_FACTOR1 command event. When the command is received, `MathReceiver` should emit an event with the updated factor. The event should be throttled (i.e. stop emitting) after three invocations. Normally, throttling is used to prevent event floods if there a endlessly repeating condition.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;2) MR_UPDATED_FACTOR2 event. When the factor2 parameter (see below) is updated, `MathReceiver` should emit an event with the updated value.</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;3) MR_OPERATION_PERFORMED event. When the component receives a request to perform the operation, it should emit an event with the arguments and operation.</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;4) MR_THROTTLE_CLEARED in response to the MR_CLEAR_EVENT_THROTTLE command above.</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;### 1.2.3 Channels</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;`MathReceiver` should have the following channels:</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;1) A channel that has a serializable structure argument that contains the two terms in the operation as well as the operation and the result. This will be used to illustrate an XML defined serializable as a single telemetry channel.</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;2) A channel that counts the number of MR_SET_FACTOR1 commands received, so that a count can be known past the throttled event.</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;3) A channel for each of the factors used in the operation.</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;### 1.2.4 Parameters</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;`MathReceiver` will have one parameter, a second factor used in the operation.</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;## 1.3 Operation</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;`MathReceiver` will perform the following operation when requested by `MathSender`:</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;result = (value1 operation value2)*factor1/factor2</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;# 2 Implementation</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;This section will cover the implementation of the components for this tutorial. The implementation of these components </div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;will have the following steps:</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;1) Define the `MathOpPort` and &#39;MathResultPort&#39; ports that are used between the components.</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;2) Define the `MathSender` component in XML and compile it.</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;3) Implement the `MathSender` derived implementation class. </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;4) Unit test the `MathSender` implementation component.</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;5) Define the `MathReceiver` component in XML.</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;6) Implement the `MathReceiver` implementation class.</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;7) Unit test the `MathReceiver` implementation class.</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;8) Connect the classes to the `Ref` topology.</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;9) Run the ground system and exercise the commands and view the telemetry and events in the GUI.</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;## 2.1 Port definition</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;There are two ports to define in order to perform the operation between the components. The XML for the ports will be first shown in their entirety, and then the individual parts will be described.</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;### 2.1.1 MathOpPort</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;`MathOpPort` is responsible for passing the invocation of the operation from `MathSender` to `MathReceiver`. The new XML file should be placed in a new directory `Ref/MathPorts` with the name `MathOpPortAi.xml`. The XML for the port is as follows:</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;```xml</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;&lt;interface name=&quot;MathOp&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    &lt;comment&gt;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    Port to perform an operation on two numbers</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    &lt;/comment&gt;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    &lt;args&gt;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;       &lt;/arg&gt;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;       &lt;/arg&gt;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        &lt;arg name=&quot;operation&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            &lt;enum name=&quot;MathOperation&quot;&gt;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                &lt;item name=&quot;MATH_ADD&quot;/&gt;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                &lt;item name=&quot;MATH_SUB&quot;/&gt;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                &lt;item name=&quot;MATH_MULTIPLY&quot;/&gt;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                &lt;item name=&quot;MATH_DIVIDE&quot;/&gt;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            &lt;comment&gt;operation argument&lt;/comment&gt;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        &lt;/arg&gt;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    &lt;/args&gt;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;&lt;/interface&gt;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;```</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;#### 2.1.1.1 Port Name Specification</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;```xml</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;&lt;interface name=&quot;MathOp&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    &lt;comment&gt;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    Port to perform an operation on two numbers</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    &lt;/comment&gt;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;...</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;&lt;/interface&gt;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;```</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;The `interface` tag specifies that a port is being defined. The attributes are as follows:</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;|---|---|</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;|name|The name of the component type. Becomes the C++ class name|</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;|namespace|The namespace of the component. The C++ namespace the where the component class will appear| </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;#### 2.1.1.2 Port Argument Specification</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;The port arguments are passed from component to component when they are connected. The port argument XML is as follows:</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;```xml</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    &lt;args&gt;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;       &lt;/arg&gt;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;       &lt;/arg&gt;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        &lt;arg name=&quot;operation&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            &lt;enum name=&quot;MathOperation&quot;&gt;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                &lt;item name=&quot;MATH_ADD&quot;/&gt;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                &lt;item name=&quot;MATH_SUB&quot;/&gt;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                &lt;item name=&quot;MATH_MULTIPLY&quot;/&gt;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                &lt;item name=&quot;MATH_DIVIDE&quot;/&gt;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            &lt;comment&gt;operation argument&lt;/comment&gt;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        &lt;/arg&gt;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    &lt;/args&gt;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;```</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;The `&lt;args&gt;` tag begins the section of the XML defining the arguments, while the `&lt;arg&gt;` tag defines a particular argument. The port argument attributes are define as follows:</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;|---|---|</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;|name|The name of the argument. Becomes the argument name in the C++ call|</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;|type|The type of the arguments. Can be one of the built-in types, a user define type, or an enumeration|</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;The enumerations are a special type of argument. When `type=&quot;ENUM&quot;` is an attribute of the arguments, a further listing of the elements of the enumeration are needed. For each element of the array, a name is specified. These end up being C++ enumerated types.</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;```xml</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;           &lt;enum name=&quot;MathOperation&quot;&gt;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                &lt;item name=&quot;MATH_ADD&quot;/&gt;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                &lt;item name=&quot;MATH_SUB&quot;/&gt;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                &lt;item name=&quot;MATH_MULTIPLY&quot;/&gt;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                &lt;item name=&quot;MATH_DIVIDE&quot;/&gt;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; ```</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;#### 2.1.1.3 Adding the port to the build</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;The build system needs to be made aware of the port XML. To do this, the user needs to create a `CMakeLists.txt` file in</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;the directory of the port. Create a file named `CMakeLists.txt` in the `MathPorts` directory. This file tells the build</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;system that a new file needs to be added to the build. Here are the contents:</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;```cmake</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpPortAi.xml&quot;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;register_fprime_module()</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;```</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;Here the source files for this module are listed. In the case of ports, only the Ai.xml file is needed. The next step is</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;to add the `MathPorts` to the `Ref` project.</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;The port can be added into the `Ref` project by editing the `Ref/CMakeLists.txt`. This will add the port directory into</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;the directories available to the `Ref` build.  Find the following lines in `Ref/CMakeLists.txt` and append a record with</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;the current directory.</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;```cmake</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;...</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;``` </div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;The file after modification should look like the following:</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;```cmake</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;...</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;``` </div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;Now that the ports directory is part of the build system, the port can be built. If you have not already generated a</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;build directory for `Ref` as described in the &quot;INSTALL.md&quot; and the &quot;Getting Started&quot; tutorial, then run the following</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;commands to generate a build. </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;```shell</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;# Change to Ref directory</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;cd fprime/Ref</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;fprime-util generate</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;```</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;Now, the port code can be generated and compiled:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;```shell</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;# Change to the MathPorts directory from Ref</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;cd MathPorts</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;fprime-util build</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;```</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;The code generation from the XML produces two files, both of which are part of the generated build directory:</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;```</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; MathOpPortAc.cpp</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; MathOpPortAc.hpp </div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;```</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;These contain the C++ classes that implement the port functionality. The build system will automatically compile them when it is aware of the port XML file.</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;### 2.1.2 MathResultPort</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;`MathResultPort` is responsible for passing the result of the operation from `MathReceiver` to `MathSender`. The new XML file should be placed in the `Ref/MathPorts` directory with the name `MathResultPortAi.xml`. The XML for the port is as follows:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;```xml</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;&lt;interface name=&quot;MathResult&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    &lt;comment&gt;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    Port to return the result of a math operation</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    &lt;/comment&gt;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    &lt;args&gt;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        &lt;arg name=&quot;result&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            &lt;comment&gt;the result of the operation&lt;/comment&gt;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        &lt;/arg&gt;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    &lt;/args&gt;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;&lt;/interface&gt;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;```</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;This file can be added to the `CMakeLists.txt` in the `Ref/MathPorts` directory:</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;```cmake</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpPortAi.xml&quot;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathResultPortAi.xml&quot;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;register_fprime_module()</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;```</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;Running `fprime-util build` as before will compile the new port XML file and generate the C++ Autogenerated</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;files. The code generated to implement ports is complete. Developers do not need to add any implementation code of their</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;own to port definitions.</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;## 2.2 Serializable Definition</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;A structure needs to be defined that represents the channel value needed by `MathReceiver`. All port calls, telemetry channels, events and parameters need to be comprised of `Serializable` values, or values that can be turned into a byte stream. This is needed to pass port arguments through message queues and to pass commands and telemetry to and from the ground system. Built-in basic types like integers, floating point numbers and boolean values are supported by the framework, but there are times when a developer wishes to use a custom-defined type, perhaps to keep members of a object consistent with each other. These structures can be defined in XML and the code generator will generate the C++ classes with all the neccessary serialization functions. Developers can hand-code their own, but they are not usable for telemetry since the ground sysmtem needs an XML definition to decode them.</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;### 2.2.1 MathOp</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;The `MathOp` serializable structure is needed by `MathReceiver` for a telemetry channel that gives the values of the operation. A new directory named `Ref/MathTypes` should be created for the structure, and the file should be named `MathOpSerializableAi.xml`. The XML is as follows:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;```xml</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;&lt;serializable namespace=&quot;Ref&quot; name=&quot;MathOp&quot;&gt;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    &lt;comment&gt;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    This value holds the values of a math operation</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    &lt;/comment&gt;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    &lt;members&gt;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        &lt;member name=&quot;val1&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        &lt;member name=&quot;val2&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        &lt;member name=&quot;op&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            &lt;enum name=&quot;Operation&quot;&gt;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                &lt;item name=&quot;ADD&quot;/&gt;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                &lt;item name=&quot;SUB&quot;/&gt;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                &lt;item name=&quot;MULT&quot;/&gt;           </div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                &lt;item name=&quot;DIVIDE&quot;/&gt;           </div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        &lt;/member&gt;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        &lt;member name=&quot;result&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    &lt;/members&gt;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;&lt;/serializable&gt;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;```</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;Add a `CMakeLists.txt` file for the serializable:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;```cmake</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathOpSerializableAi.xml&quot;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;register_fprime_module()</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;```</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;#### 2.2.1.1 Serializable Name Specification</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;The opening tag of the XML specifies the type name and namespace of the structure:</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;```xml</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;&lt;serializable namespace=&quot;Ref&quot; name=&quot;MathOp&quot;&gt;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;...</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;&lt;/serializable&gt;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;```</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;#### 2.2.1.2 Serializable Members</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;The `members` tag starts the section of the XML that specifies the members of the structure:</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;```xml</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    &lt;members&gt;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        &lt;member name=&quot;val1&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        &lt;member name=&quot;val2&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        &lt;member name=&quot;op&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            &lt;enum name=&quot;Operation&quot;&gt;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                &lt;item name=&quot;ADD&quot;/&gt;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                &lt;item name=&quot;SUB&quot;/&gt;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                &lt;item name=&quot;MULT&quot;/&gt;           </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                &lt;item name=&quot;DIVIDE&quot;/&gt;           </div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        &lt;/member&gt;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        &lt;member name=&quot;result&quot; type=&quot;F32&quot;/&gt;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    &lt;/members&gt;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;```</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;As with the arguments to port definitions, built-in types can be specified as well as enumerations.</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;As before with the port definitions, the `Ref/MathTypes` directory needs to be added to `Ref/CMakeLists.txt`.  </div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;```cmake</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;...</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathTypes/&quot;)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;``` </div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;This XML defined structure compiles to a C++ class that has accessors for the members of the structure.</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;## 2.3 Component Definition</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;### 2.3.1 MathSender Component</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;The `MathSender` component XML definition is as follows. The XML should be placed in a file `Ref/MathSender/MathSenderComponentAi.xml`</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;```xml</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;&lt;component name=&quot;MathSender&quot; kind=&quot;active&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathOpPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathResultPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    &lt;comment&gt;Component sending a math operation&lt;/comment&gt;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    &lt;ports&gt;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        &lt;port name=&quot;mathOut&quot; data_type=&quot;Ref::MathOp&quot; kind=&quot;output&quot;&gt;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            Port for sending the math operation</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        &lt;port name=&quot;mathIn&quot; data_type=&quot;Ref::MathResult&quot; kind=&quot;async_input&quot;&gt;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            Port for returning the math result</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    &lt;/ports&gt;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    &lt;commands&gt;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        &lt;command kind=&quot;async&quot; opcode=&quot;0&quot; mnemonic=&quot;MS_DO_MATH&quot;&gt;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            Do a math operation</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    &lt;comment&gt;The first value&lt;/comment&gt;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    &lt;comment&gt;The second value&lt;/comment&gt;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                &lt;arg name=&quot;operation&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    &lt;enum name=&quot;MathOp&quot;&gt;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        &lt;item name=&quot;ADD&quot;/&gt;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        &lt;item name=&quot;SUBTRACT&quot;/&gt;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        &lt;item name=&quot;MULTIPLY&quot;/&gt;           </div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        &lt;item name=&quot;DIVIDE&quot;/&gt;           </div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    &lt;/enum&gt;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                    &lt;comment&gt;The operation to perform&lt;/comment&gt;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                &lt;/arg&gt;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;             &lt;/args&gt;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        &lt;/command&gt;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    &lt;/commands&gt;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    &lt;telemetry&gt;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        &lt;channel id=&quot;0&quot; name=&quot;MS_VAL1&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            The first value</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        &lt;channel id=&quot;1&quot; name=&quot;MS_VAL2&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            The second value</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        &lt;channel id=&quot;2&quot; name=&quot;MS_OP&quot; data_type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            &lt;enum name=&quot;MathOpTlm&quot;&gt;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                &lt;item name=&quot;ADD_TLM&quot;/&gt;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                &lt;item name=&quot;SUB_TLM&quot;/&gt;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                &lt;item name=&quot;MULT_TLM&quot;/&gt;           </div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                &lt;item name=&quot;DIV_TLM&quot;/&gt;           </div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            The operation</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        &lt;channel id=&quot;3&quot; name=&quot;MS_RES&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            The result</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    &lt;/telemetry&gt;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    &lt;events&gt;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        &lt;event id=&quot;0&quot; name=&quot;MS_COMMAND_RECV&quot; severity=&quot;ACTIVITY_LO&quot; format_string=&quot;Math Cmd Recvd: %f %f %d&quot;  &gt;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            Math command received</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    &lt;comment&gt;The val1 argument&lt;/comment&gt;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    &lt;comment&gt;The val2 argument&lt;/comment&gt;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                &lt;arg name=&quot;op&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    &lt;comment&gt;The requested operation&lt;/comment&gt;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                &lt;enum name=&quot;MathOpEv&quot;&gt;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    &lt;item name=&quot;ADD_EV&quot;/&gt;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    &lt;item name=&quot;SUB_EV&quot;/&gt;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                    &lt;item name=&quot;MULT_EV&quot;/&gt;           </div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    &lt;item name=&quot;DIV_EV&quot;/&gt;           </div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                &lt;/enum&gt;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        &lt;event id=&quot;1&quot; name=&quot;MS_RESULT&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Math result is %f&quot; &gt;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            Received math result</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                &lt;arg name=&quot;result&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    &lt;comment&gt;The math result&lt;/comment&gt;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    &lt;/events&gt;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;&lt;/component&gt;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;```</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;#### 2.3.1.1 Component Name Specification</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;The component name is specified in the opening tag of the XML:</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;```xml</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;&lt;component name=&quot;MathSender&quot; kind=&quot;active&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;...</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;&lt;/component&gt;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;```</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;The attributes of the tag are as follows:</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;|---|---|</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;|name|The component name|</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;|kind|What the threading/queuing model of the component is. Can be `passive`, `queued`, or `active`|</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;|namespace|The C++ namespace the component will be defined in|</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;#### 2.3.1.2 Port Imports</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;The ports needed for the component are imported using `import_port_type` tags:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;```xml</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathOpPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathResultPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;```</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;The path in the port import statement is relative to the root of the repository. There are a number of ports automatically included by the code generator when commands, telemetry, events or parameters are defined. They are:</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;|Facility|Ports|</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;|---|---|</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;|Commands|`Fw/Command/CmdPortAi.xml`,`Fw/Command/CmdResponsePortAi.xml`,`Fw/Command/CmdRegPortAi.xml`|</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;|Events|`Fw/Log/LogPortAi.xml`,`Fw/Log/LogTextPortAi.xml`|</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;|Telemetry|`Fw/Tlm/TlmPortAi.xml`|</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;|Parameters|`Fw/PrmGetPortAi.xml`,`Fw/PrmSetPortAi.xml`|</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;#### 2.3.1.3 Port Declarations</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;Ports and their attributes are declared once the port definitions are included. </div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;```xml</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    &lt;ports&gt;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        &lt;port name=&quot;mathOut&quot; data_type=&quot;Ref::MathOp&quot; kind=&quot;output&quot;&gt;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            Port for sending the math operation</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        &lt;port name=&quot;mathIn&quot; data_type=&quot;Ref::MathResult&quot; kind=&quot;async_input&quot;&gt;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            Port for returning the math result</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    &lt;/ports&gt;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;```</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;The port attributes are:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;|---|---|</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;|name|The port name|</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;|data_type|The type of the port as defined in the included port definitions, in the form `namepace::name`|</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;|kind|The kind of port. Can be `sync_input`,`async_input`,`guarded_input`, or `output`|</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;For `MathSender`, the request for the operation will be sent on the `mathOut` output port, and the result will be returned on the `mathIn` asynchronous port. Because the component is active and the result input port is asynchronous, the port handler will execute on the thread of `MathSender`.</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;#### 2.3.1.4 Command Declarations</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;The commands defined for the component are:</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;```xml</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    &lt;commands&gt;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        &lt;command kind=&quot;async&quot; opcode=&quot;0&quot; mnemonic=&quot;MS_DO_MATH&quot;&gt;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            Do a math operation</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                    &lt;comment&gt;The first value&lt;/comment&gt;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    &lt;comment&gt;The second value&lt;/comment&gt;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                &lt;arg name=&quot;operation&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    &lt;enum name=&quot;MathOp&quot;&gt;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        &lt;item name=&quot;ADD&quot;/&gt;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        &lt;item name=&quot;SUBTRACT&quot;/&gt;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        &lt;item name=&quot;MULTIPLY&quot;/&gt;           </div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        &lt;item name=&quot;DIVIDE&quot;/&gt;           </div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                    &lt;/enum&gt;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                    &lt;comment&gt;The operation to perform&lt;/comment&gt;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                &lt;/arg&gt;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;             &lt;/args&gt;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        &lt;/command&gt;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    &lt;/commands&gt;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;```</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;The `&lt;command&gt;` tag starts the section containing commands for `MathSender`. For each command, the following attributes are defined:</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;|---|---|</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;|mnemonic|A text version of the command name, used in sequences and the ground tool|</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;|opcode|A numeric value for the command. The value is relative to a base value set when the component is added to a topology|</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;|kind|The kind of command. Can be `sync_input`,`async_input`,`guarded_input`, or `output`|</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;#### 2.3.1.5 Telemetry</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;The telemetry XML is as follows:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;```xml</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    &lt;telemetry&gt;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        &lt;channel id=&quot;0&quot; name=&quot;MS_VAL1&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            The first value</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        &lt;channel id=&quot;1&quot; name=&quot;MS_VAL2&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            The second value</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        &lt;channel id=&quot;2&quot; name=&quot;MS_OP&quot; data_type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            &lt;enum name=&quot;MathOpTlm&quot;&gt;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                &lt;item name=&quot;ADD_TLM&quot;/&gt;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                &lt;item name=&quot;SUB_TLM&quot;/&gt;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                &lt;item name=&quot;MULT_TLM&quot;/&gt;           </div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                &lt;item name=&quot;DIV_TLM&quot;/&gt;           </div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            &lt;/enum&gt;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            The operation</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        &lt;channel id=&quot;3&quot; name=&quot;MS_RES&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            The result</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    &lt;/telemetry&gt;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;```</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;The `&lt;telemetry&gt;` tag starts the section containing telemetry channels for `MathSender`. For each channel, the following attributes are defined:</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;|---|---|</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;|name|The channel name|</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;|id|A numeric value for the channel. The value is relative to a base value set when the component is added to a topology|</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;|data_type|The data type of the channel. Can be a built-in type, an enumeration or an externally defined serializable type|</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;#### 2.3.1.6 Events</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;The XML for the defined events is as follows:</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;```xml</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    &lt;events&gt;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        &lt;event id=&quot;0&quot; name=&quot;MS_COMMAND_RECV&quot; severity=&quot;ACTIVITY_LO&quot; format_string = &quot;Math Cmd Recvd: %f %f %d&quot;  &gt;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            Math command received</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                &lt;arg name=&quot;val1&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                    &lt;comment&gt;The val1 argument&lt;/comment&gt;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                &lt;arg name=&quot;val2&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    &lt;comment&gt;The val1 argument&lt;/comment&gt;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                &lt;arg name=&quot;op&quot; type=&quot;ENUM&quot;&gt;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    &lt;comment&gt;The requested operation&lt;/comment&gt;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                &lt;enum name=&quot;MathOpEv&quot;&gt;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                    &lt;item name=&quot;ADD_EV&quot;/&gt;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    &lt;item name=&quot;SUB_EV&quot;/&gt;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    &lt;item name=&quot;MULT_EV&quot;/&gt;           </div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    &lt;item name=&quot;DIV_EV&quot;/&gt;           </div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                &lt;/enum&gt;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        &lt;event id=&quot;1&quot; name=&quot;MS_RESULT&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Math result is %f&quot; &gt;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            Received math result</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                &lt;arg name=&quot;result&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                    &lt;comment&gt;The math result&lt;/comment&gt;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    &lt;/events&gt;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;```</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;The `&lt;events&gt;` tag starts the section containing events for `MathSender`. For each event, the following attributes are defined:</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;|---|---|</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;|name|The event name|</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;|severity|The severity of the event. Can be DIAGNOSTIC, ACTIVITY_LO, ACTIVITY_HI, WARNING_LO, WARNING_HI or FATAL.</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;|id|A numeric value for the event. The value is relative to a base value set when the component is added to a topology|</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;|format_string|A C-style format string for displaying the event and the argument values.|</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;The directory containing the component XML can be added to the list of modules in `Ref/CMakeLists.txt`:</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;```cmake</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;...</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/PingReceiver/&quot;)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/RecvBuffApp/&quot;)</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SendBuffApp/&quot;)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/SignalGen/&quot;)</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathPorts/&quot;)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathTypes/&quot;)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;add_fprime_subdirectory(&quot;${CMAKE_CURRENT_LIST_DIR}/MathSender/&quot;)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;``` </div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;Create a `CMakeLists.txt` file in `Ref/MathSender` and add `MathSenderComponentAi.xml`.</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;```cmake</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;)</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;register_fprime_module()</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;```</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;Once it is added, add the directory to the build and build the component by typing `fprime-util build` from the `Ref` directory.</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;### 2.3.2 MathReceiver Component</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;#### 2.3.2.1 Component Specification</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;The `MathReceiver` component XML is as follows:</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;```xml</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;&lt;component name=&quot;MathReceiver&quot; kind=&quot;queued&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathOpPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    &lt;import_port_type&gt;Ref/MathPorts/MathResultPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    &lt;import_port_type&gt;Svc/Sched/SchedPortAi.xml&lt;/import_port_type&gt;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    &lt;import_serializable_type&gt;Ref/MathTypes/MathOpSerializableAi.xml&lt;/import_serializable_type&gt;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    &lt;comment&gt;Component sending a math operation&lt;/comment&gt;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    &lt;ports&gt;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        &lt;port name=&quot;mathIn&quot; data_type=&quot;Ref::MathOp&quot; kind=&quot;async_input&quot;&gt;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            Port for receiving the math operation</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        &lt;port name=&quot;mathOut&quot; data_type=&quot;Ref::MathResult&quot; kind=&quot;output&quot;&gt;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            Port for returning the math result</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        &lt;port name=&quot;SchedIn&quot; data_type=&quot;Sched&quot; kind=&quot;sync_input&quot;&gt;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            The rate group scheduler input</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    &lt;/ports&gt;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    &lt;commands&gt;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        &lt;command kind=&quot;async&quot; opcode=&quot;0&quot; mnemonic=&quot;MR_SET_FACTOR1&quot;&gt;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            Set operation multiplication factor1</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                &lt;arg name=&quot;val&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                    &lt;comment&gt;The first factor&lt;/comment&gt;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;             &lt;/args&gt;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        &lt;/command&gt;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        &lt;command kind=&quot;async&quot; opcode=&quot;1&quot; mnemonic=&quot;MR_CLEAR_EVENT_THROTTLE&quot;&gt;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            &lt;comment&gt;Clear the event throttle</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        &lt;/command&gt;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    &lt;/commands&gt;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    &lt;telemetry&gt;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        &lt;channel id=&quot;0&quot; name=&quot;MR_OPERATION&quot; data_type=&quot;Ref::MathOp&quot;&gt;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            The operation</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        &lt;channel id=&quot;1&quot; name=&quot;MR_FACTOR1S&quot; data_type=&quot;U32&quot;&gt;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            The number of MR_SET_FACTOR1 commands</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        &lt;channel id=&quot;2&quot; name=&quot;MR_FACTOR1&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            Factor 1 value</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        &lt;channel id=&quot;3&quot; name=&quot;MR_FACTOR2&quot; data_type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            Factor 2 value</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        &lt;/channel&gt;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    &lt;/telemetry&gt;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    &lt;events&gt;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        &lt;event id=&quot;0&quot; name=&quot;MR_SET_FACTOR1&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Factor 1: %f&quot;  throttle = &quot;3&quot;   &gt;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            Operation factor 1</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                &lt;arg name=&quot;val&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                    &lt;comment&gt;The factor value&lt;/comment&gt;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        &lt;event id=&quot;1&quot; name=&quot;MR_UPDATED_FACTOR2&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Factor 2 updated to: %f&quot; &gt;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            Updated factor 2</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                &lt;arg name=&quot;val&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    &lt;comment&gt;The factor value&lt;/comment&gt;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        &lt;event id=&quot;2&quot; name=&quot;MR_OPERATION_PERFORMED&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Operation performed: %s&quot; &gt;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            Math operation performed</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                &lt;arg name=&quot;val&quot; type=&quot;Ref::MathOp&quot;&gt;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    &lt;comment&gt;The operation&lt;/comment&gt;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        &lt;event id=&quot;3&quot; name=&quot;MR_THROTTLE_CLEARED&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Event throttle cleared&quot; &gt;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            Event throttle cleared</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    &lt;/events&gt;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    &lt;parameters&gt;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        &lt;parameter id=&quot;0&quot; name=&quot;factor2&quot; data_type=&quot;F32&quot; default=&quot;1.0&quot; set_opcode=&quot;10&quot; save_opcode=&quot;11&quot;&gt;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            A test parameter</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        &lt;/parameter&gt;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    &lt;/parameters&gt;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    </div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;&lt;/component&gt;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;```</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;The `CMakeLists.txt` file for this component is as follows:</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;```cmake</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponentAi.xml&quot;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;register_fprime_module()</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;```</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;Don&#39;t forget to `Ref/MathReceiver` to `Ref/CMakeLists.txt`.</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;Many of the elements are the same as described in `MathSender`, so this section will highlight the differences.</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;#### 2.3.2.1 Queued component</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;The `MathReceiver` component is queued, which means it can receive asynchronous port invocations as messages, but needs an external thread to dequeue them.</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;#### 2.3.2.2 Importing the serializable type</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;The telemetry channels and events use a serializable type, `Ref::MathOp` to illustrate the use of those types. The following line specifies the import for this type:</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;```xml</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   &lt;import_serializable_type&gt;Ref/MathTypes/MathOpSerializableAi.xml&lt;/import_serializable_type&gt;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;```</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;This type is then available for events and channels, but are not available for parameters and command arguments.</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;#### 2.3.2.3 Scheduler port</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;The queued component has a scheduler port that is `sync_input`. That means the port invocation is not put on a message queue, but calls the handler on the thread of the caller of the port:</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;```xml</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        &lt;port name=&quot;SchedIn&quot; data_type=&quot;Sched&quot; kind=&quot;sync_input&quot;&gt;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            The rate group scheduler input</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        &lt;/port&gt;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;```</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;This synchronous call allows the caller to pull any pending messages of the message queue using the thread of the component invoking the `SchedIn` port.</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;#### 2.3.2.4 Throttled Event</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;The `MR_SET_FACTOR1` event has a new argument `throttle = &quot;3&quot;` that specifies how many events will be emitted before the event is throttled so no more appear.</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;```xml</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        &lt;event id=&quot;0&quot; name=&quot;MR_SET_FACTOR1&quot; severity=&quot;ACTIVITY_HI&quot; format_string = &quot;Factor 1: %f&quot;  throttle = &quot;3&quot;   &gt;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            Operation factor 1</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            &lt;args&gt;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                &lt;arg name=&quot;val&quot; type=&quot;F32&quot;&gt;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                    &lt;comment&gt;The factor value&lt;/comment&gt;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                &lt;/arg&gt;          </div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            &lt;/args&gt;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        &lt;/event&gt;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;```</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;#### 2.3.2.5 Parameters</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;The `MathReceiver` component has a declaration for a parameter:</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;```xml</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    &lt;parameters&gt;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        &lt;parameter id=&quot;0&quot; name=&quot;factor2&quot; data_type=&quot;F32&quot; default=&quot;1.0&quot; set_opcode=&quot;10&quot; save_opcode=&quot;11&quot;&gt;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            &lt;comment&gt;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            A test parameter</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            &lt;/comment&gt;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        &lt;/parameter&gt;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    &lt;/parameters&gt;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;```</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;The `parameter` attributes are as follows:</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;|Attribute|Description|</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;|---|---|</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;|id|The unique parameter ID. Relative to base ID set for the component in the topology|</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;|name|The parameter name|</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;|data_type|The data type of the parameter. Must be a built-in type|</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;|default|Default value assigned to the parameter if there is an error retrieving it.|</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;|set_opcode|The opcode of the command to set the parameter. Must not overlap with any of the command opcodes|</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;|save_opcode|The opcode of the command to save the parameter. Must not overlap with any of the command opcodes|</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;## 2.4 Component Implementation</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;The component implementation consists of writing a class that is derived from the code-generated base class and filling in member functions that implement the port calls. </div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;### 2.4.1 MathSender Implementation</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;#### 2.4.1.1 Stub Generation</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;There is a F´ utility command that will generate stubs that the developer can fill in. The command to generate the stubs is: `fprime-util impl`.</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;This should be run in the directory for the MathSender component, and will generate two files:</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;```</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;MathSenderComponentImpl.hpp-template</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;MathSenderComponentImpl.cpp-template</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;```</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;Rename the files by removing the `-template` from the end of the file names.</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;```</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;MathSenderComponentImpl.hpp</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;MathSenderComponentImpl.cpp</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;```</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;Add the new files to the MathSender&#39;s `CMakeLists.txt` file:</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;```cmake</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentImpl.cpp&quot;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;register_fprime_module()</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;```</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;Now attempt to build the component with:</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;```</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;fprime-util build</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;```</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;The stub files should successfully compile.</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;#### 2.4.1.2 Handler implementation</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;The next step is to fill in the handler with implementation code. </div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;First, find the empty command handler in the `MathSenderComponentImpl.cpp` file:</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;```c++</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  void MathSenderComponentImpl ::</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    MS_DO_MATH_cmdHandler(</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        const FwOpcodeType opCode,</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        const U32 cmdSeq,</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        F32 val1,</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        F32 val2,</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        MathOp operation</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    )</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    // TODO</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;```</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;Then, fill in the function with the code to perform the functions described at the beginning of the tutorial:</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;```c++</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  void MathSenderComponentImpl ::</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    MS_DO_MATH_cmdHandler(</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        const FwOpcodeType opCode,</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        const U32 cmdSeq,</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        F32 val1,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        F32 val2,</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        MathOp operation</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    )</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    MathOpTlm opTlm;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    MathOperation opPort;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    MathOpEv opEv;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    switch (operation) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      case ADD:</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;          opTlm = ADD_TLM;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          opPort = MATH_ADD;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          opEv = ADD_EV;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          break;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      case SUBTRACT:</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          opTlm = SUB_TLM;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          opPort = MATH_SUB;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          opEv = SUB_EV;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;          break;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      case MULTIPLY:</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;          opTlm = MULT_TLM;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;          opPort = MATH_MULTIPLY;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          opEv = MULT_EV;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          break;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      case DIVIDE:</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          opTlm = DIV_TLM;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;          opPort = MATH_DIVIDE;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          opEv = DIV_EV;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          break;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      default:</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;          FW_ASSERT(0,operation);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          break;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    this-&gt;tlmWrite_MS_OP(opTlm);</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    this-&gt;tlmWrite_MS_VAL1(val1);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    this-&gt;tlmWrite_MS_VAL2(val2);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    this-&gt;log_ACTIVITY_LO_MS_COMMAND_RECV(val1,val2,opEv);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    this-&gt;mathOut_out(0,val1,val2,opPort);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    // reply with completion status</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;```</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;The handler will send the appropriate events and telemetry values, then invoke the output math operation port to request the operation. </div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;Note that each channel and event argument that has an enumeration has a unique type declaration. </div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;Finally, note that the output command response port must be called with a command status in order to let the framework components know that the command is complete. </div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;If the completion status isn&#39;t sent, it will stall any sequences the command was part of. </div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;There are command error status along with successful completions. </div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;Most commands return this status at the end of the handler, but component implementations can store the `opCode` and `cmdSeq` values to return later, but those specific values must be returned in order to match the status with the command originally sent.</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;Find the empty result handler:</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;```c++</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  void MathSenderComponentImpl ::</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    mathIn_handler(</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        const NATIVE_INT_TYPE portNum,</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        F32 result</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    )</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    // TODO</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;```</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;Fill in the result handler with code that reports telemetry and an event:</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;```c++</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  void MathSenderComponentImpl ::</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    mathIn_handler(</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        const NATIVE_INT_TYPE portNum,</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        F32 result</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    )</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      this-&gt;tlmWrite_MS_RES(result);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      this-&gt;log_ACTIVITY_HI_MS_RESULT(result);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;```</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;This handler reports the result via a telemetry channel and an event.</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;Once complete, add the directory to the build and build the component by typing `fprime-util build` from the `Ref` directory.</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;#### 2.4.1.3 Unit Tests</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;Unit Tests are used to exercise the component&#39;s functions by invoking input ports and commands and checking the values of output ports, telemetry and events.</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;##### 2.4.1.3.1 Test Code Generation</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;The code generator will generate test components that can be connected to the component to enable a set of unit tests to check functionality and to get coverage of all the code. To generate a set of files for testing, from the module directory type:</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;```shell</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;fprime-util impl --ut</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;```</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;The files that are generated are:</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;```</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;Tester.hpp</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;Tester.cpp</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;TesterBase.hpp</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;TesterBase.cpp</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;GTestBase.hpp</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;GTestBase.cpp</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;```</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;The functions of the files are:</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;|File|Function|</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;|---|---|</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;|TesterBase.*|Base class for test class. Defines necessary handlers as well as helper functions</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;|GTestBase.*|Helper class derived from TesterBase that has macros that use Google Test to test interfaces|</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;|Tester.*|Derived tester class that inherits from GTestBase. Includes instance of the component and helpers to connect ports|</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;Unit tests are built in subdirectories of the module, so the unit test file must be copied there. The build system supports a standard subdirectory of `test/ut` below the module being tested. While in the MathSender directory, create the `test/ut` directory:</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;```</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;mkdir -p test/ut</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;```</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;Move the above set of files into that subdirectory.</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;The new unit test files have to be registered with the build system, so modifications to the `CMakeLists.txt` files are</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;necessary. To do this, add a &quot;UT_SOURCE_FILES&quot; variable to `CMakeLists.txt` followed by a call `register_fprime_ut()`.</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;The UT_SOURCE_FILES variable contains a list of the C++ files associated with the UT (see list above).</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;The final `CMakeLists.txt` file should look like the following:</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;```cmake</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentAi.xml&quot;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathSenderComponentImpl.cpp&quot;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;)</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;register_fprime_module()</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;set(UT_SOURCE_FILES</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/main.cpp&quot;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/Tester.cpp&quot;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/TesterBase.cpp&quot;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/test/ut/GTestBase.cpp&quot;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;register_fprime_ut()</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;```</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;The `UT_SOURCE_FILES` variable includes any source code needed to run the test. It usually only includes the generated</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;test code and a `main.cpp`, but it can include any code the user needs to test.</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;A `UT_MODS` variable may be set should the UT depend on modules not automatically included by the component.</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;##### 2.4.1.3.2 Test Code Implementation</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;The `main.cpp` file must be added. For this test, it appears like this:</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;```c++</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;#include &quot;Tester.hpp&quot;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;TEST(Nominal, AddOperationTest) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    tester.testAddCommand();</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;}</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;TEST(Nominal, SubOperationTest) {</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    tester.testSubCommand();</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;}</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;TEST(Nominal, MultOperationTest) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    tester.testMultCommand();</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;}</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;TEST(Nominal, DivideOperationTest) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    tester.testDivCommand();</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;}</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;int main(int argc, char **argv) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  ::testing::InitGoogleTest(&amp;argc, argv);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  return RUN_ALL_TESTS();</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;}</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;```</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;F&#39; uses the Google Test framework to run unit tests. For more information about the Google Test Framework see here:</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;https://github.com/google/googletest</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;In the Google Test framework, the following lines of code are standard:</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;```c++</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;int main(int argc, char **argv) {</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  ::testing::InitGoogleTest(&amp;argc, argv);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  return RUN_ALL_TESTS();</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;}</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;```</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;For each test, there is a Google Test macro defined:</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;```c++</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;TEST(Name1, Name2) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    // run some code</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;```</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;The code in each of the macros defined this way will automatically be run be the framework.</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;In this case, the tests are defined as follows:</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;```c++</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;TEST(Nominal, AddOperationTest) {</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    tester.testAddCommand();</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;}</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;TEST(Nominal, SubOperationTest) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    tester.testSubCommand();</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;TEST(Nominal, MultOperationTest) {</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    tester.testMultCommand();</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;}</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;TEST(Nominal, DivideOperationTest) {</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    Ref::Tester tester;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    tester.testDivCommand();</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;}</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;```</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;For each unit test, the Google Test test case for F&#39; components looks like:</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;```c++</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;TEST(Nominal, DivideOperationTest) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    NameSpace::Tester tester;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    tester.someUnitTestFunc();</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;```</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;The test component is instantiated here:</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;```c++</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    NameSpace::Tester tester;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;```</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;This allows the component to start from an newly initialized state for each unit test.</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;The unit test is executed by calling a member function of the `tester` class:</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;```c++</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    tester.someUnitTestFunc();</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;```</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;The `Tester.hpp` stub can be updated to include the declarations of the unit test functions:</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;```c++</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    ...</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    public:</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      // ---------------------------------------------------------------------- </div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      // Tests</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      // ---------------------------------------------------------------------- </div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      //! Test operation command</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      //!</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      void testAddCommand(void);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      void testSubCommand(void);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      void testMultCommand(void);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      void testDivCommand(void);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    private:</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    ...</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;```</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;The next step is to add the specific test cases to the `Tester.cpp` implementation file. It is important to note that the unit tests are designed to be single-threaded. The active components do not have their threads started, so any messages to asynchronous ports are manually retrieved from the message queue and dispatched to handlers. This makes testing simpler since the execution of the thread in response to port calls or commands does not need to be managed. Examples of this will be seen in the test code.</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;The first test case will be to test the `MS_DO_MATH` command for the addition operation. In the example component implementation, `MS_DO_MATH` command calls the `mathOut` output port and emits some channelized telmetry and events. The test component provides methods for invoking the command and checking that the telemetry and events were emitted as expected. The steps to write the test case are as follows:</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;Add a member function to the implementation class in `Tester.cpp` to implement the test case:</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;```c++</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  // ----------------------------------------------------------------------</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  // Tests </div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  // ----------------------------------------------------------------------</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  void Tester ::</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    testAddCommand(void)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      // send MS_DO_MATH command</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      this-&gt;sendCmd_MS_DO_MATH(0,10,1.0,2.0,MathSenderComponentBase::ADD);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      // retrieve the message from the message queue and dispatch the command to the handler</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;      this-&gt;component.doDispatch();</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      // verify that that only one output port was called</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      ASSERT_FROM_PORT_HISTORY_SIZE(1);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      // verify that the math operation port was only called once</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      ASSERT_from_mathOut_SIZE(1);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      // verify the arguments of the operation port</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      ASSERT_from_mathOut(0,1.0,2.0,MATH_ADD);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      // verify telemetry - 3 channels were written</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      ASSERT_TLM_SIZE(3);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      // verify that the desired telemetry values were only sent once</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      ASSERT_TLM_MS_VAL1_SIZE(1);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      ASSERT_TLM_MS_VAL2_SIZE(1);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      ASSERT_TLM_MS_OP_SIZE(1);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      // verify that the correct telemetry values were sent</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      ASSERT_TLM_MS_VAL1(0,1.0);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      ASSERT_TLM_MS_VAL2(0,2.0);</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      ASSERT_TLM_MS_OP(0,MathSenderComponentBase::ADD_TLM);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      // verify only one event was sent</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      ASSERT_EVENTS_SIZE(1);</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      // verify the expected event was only sent once</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      ASSERT_EVENTS_MS_COMMAND_RECV_SIZE(1);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      // verify the correct event arguments were sent</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      ASSERT_EVENTS_MS_COMMAND_RECV(0,1.0,2.0,MathSenderComponentBase::ADD_EV);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      // verify command response was sent</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      ASSERT_CMD_RESPONSE_SIZE(1);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      // verify the command response was correct as expected</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      ASSERT_CMD_RESPONSE(0,MathSenderComponentBase::OPCODE_MS_DO_MATH,10,Fw::COMMAND_OK);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      // reset all telemetry and port history</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      this-&gt;clearHistory();</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      // call result port. We don&#39;t care about the value being correct since MathSender doesn&#39;t</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      this-&gt;invoke_to_mathIn(0,10.0);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      // retrieve the message from the message queue and dispatch the command to the handler</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      this-&gt;component.doDispatch();</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      // verify only one telemetry value was written</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      ASSERT_TLM_SIZE(1);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      // verify the desired telemetry channel was sent only once</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      ASSERT_TLM_MS_RES_SIZE(1);</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      // verify the values of the telemetry channel</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      ASSERT_TLM_MS_RES(0,10.0);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      // verify only one event was sent</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      ASSERT_EVENTS_SIZE(1);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      // verify the expected event was only sent once</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      ASSERT_EVENTS_MS_RESULT_SIZE(1);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      // verify the expected value of the event arguments</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      ASSERT_EVENTS_MS_RESULT(0,10.0);     </div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  }</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;```</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;Some highlights are:</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;Send the `MS_DO_MATH` command:</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;```c++</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      // send MS_DO_MATH command</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      this-&gt;sendCmd_MS_DO_MATH(0,10,1.0,2.0,MathSenderComponentBase::ADD);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      // retrieve the message from the message queue and dispatch</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      this-&gt;component.doDispatch();</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;```</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;Verify that the operation port was called as expected:</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;```c++</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      // verify that that only one output port was called</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      ASSERT_FROM_PORT_HISTORY_SIZE(1);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      // verify that the math operation port was only called once</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      ASSERT_from_mathOut_SIZE(1);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      // verify the arguments of the operation port</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      ASSERT_from_mathOut(0,1.0,2.0,MATH_ADD);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;```</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;The first call verifies that one and only one port call was made. This can be used to confirm that there were no other ports called besides the expected one.</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;The second call verifies that the port call that was made was the expected one.</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;The third call looks at a stored history of calls to this port and verifies the expected call arguments were made. The history can store multiple calls, so the first argument indicates which index in the history to examine.</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;Verify that the telemetry channels were written:</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;```c++</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      // verify telemetry - 3 channels were written</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      ASSERT_TLM_SIZE(3);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;      // verify that the desired telemetry values were only sent once</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      ASSERT_TLM_MS_VAL1_SIZE(1);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      ASSERT_TLM_MS_VAL2_SIZE(1);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      ASSERT_TLM_MS_OP_SIZE(1);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      // verify that the correct telemetry values were sent</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;      ASSERT_TLM_MS_VAL1(0,1.0);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      ASSERT_TLM_MS_VAL2(0,2.0);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      ASSERT_TLM_MS_OP(0,MathSenderComponentBase::ADD_TLM);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;```</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;The first statement verifies that three channels were written as expected. The following statements verify that the correct channels were written with the expected values.</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;Verify that the event for the command was sent:</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;```c++</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      // verify only one event was sent</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      ASSERT_EVENTS_SIZE(1);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      // verify the expected event was only sent once</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      ASSERT_EVENTS_MS_COMMAND_RECV_SIZE(1);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      // verify the correct event arguments were sent</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      ASSERT_EVENTS_MS_COMMAND_RECV(0,1.0,2.0,MathSenderComponentBase::ADD_EV);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;```</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;Next, verify that the correct response to the command was sent:</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;```c++</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      // verify command response was sent</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      ASSERT_CMD_RESPONSE_SIZE(1);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      // verify the command response was correct as expected</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      ASSERT_CMD_RESPONSE(0,MathSenderComponentBase::OPCODE_MS_DO_MATH,10,Fw::COMMAND_OK);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;```</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;Next, prepare for calling `MathSender`&#39;s result port by clearing the port and telemetry history:</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;```c++</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      // reset all telemetry and port history</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      this-&gt;clearHistory();</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;```</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;As ports and commands are invoked in the component, the test component stores the history of calls. This function clears the history, in order to provide a clean slate for the next test. There are calls to clear individual histories as well. See `TesterBase.hpp` for a list. The `this-&gt;clearHistory()` call will clear them all, so is generally preferable.</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;The next step is to invoke the port that the `MathReceiver` component will call in the example program. For the unit test, the `MathReceiver` is not present to send the result back, so the unit test will emulate that call.</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;First, the port invocation is made:</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;```c++</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      // call result port. We don&#39;t care about the value being correct since MathSender doesn&#39;t</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      this-&gt;invoke_to_mathIn(0,10.0);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      // retrieve the message from the message queue and dispatch the command to the handler</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      this-&gt;component.doDispatch();</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;```</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;Next, the test checks for the expected telemetry and events:</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;```c++</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      // verify only one telemetry value was written</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      ASSERT_TLM_SIZE(1);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      // verify the desired telemetry channel was sent only once</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      ASSERT_TLM_MS_RES_SIZE(1);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      // verify the values of the telemetry channel</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      ASSERT_TLM_MS_RES(0,10.0);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      // verify only one event was sent</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      ASSERT_EVENTS_SIZE(1);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      // verify the expected event was only sent once</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      ASSERT_EVENTS_MS_RESULT_SIZE(1);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      // verify the expected value of the event</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      ASSERT_EVENTS_MS_RESULT(0,10.0);     </div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;```</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;The other test cases are similarly implemented for the other operations. See the tutorial code for their implementation.</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;To build the unit test, type:</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;```</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;fprime-util build --ut</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;```</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;The unit test can be run by typing the following in the `MathSender` (not `test/ut`) directory:</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;```shell</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;$ fprime-util check</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;[==========] Running 4 tests from 1 test case.</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;[----------] Global test environment set-up.</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;[----------] 4 tests from Nominal</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;[ RUN      ] Nominal.AddOperationTest</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;[       OK ] Nominal.AddOperationTest (2 ms)</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;[ RUN      ] Nominal.SubOperationTest</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;[       OK ] Nominal.SubOperationTest (0 ms)</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;[ RUN      ] Nominal.MultOperationTest</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;[       OK ] Nominal.MultOperationTest (0 ms)</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;[ RUN      ] Nominal.DivideOperationTest</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;[       OK ] Nominal.DivideOperationTest (0 ms)</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;[----------] 4 tests from Nominal (3 ms total)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;[----------] Global test environment tear-down</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;[==========] 4 tests from 1 test case ran. (3 ms total)</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;[  PASSED  ] 4 tests.</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;```</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;### 2.4.2 MathReceiver Implementation</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;#### 2.4.2.1 Component Implementation</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;As before, a stub can be generated:</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;```</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;cd fprime/Ref/MathReceiver</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;fprime-util impl</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;mv MathReceiverComponentImpl.cpp-template MathReceiverComponentImpl.cpp</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;mv MathReceiverComponentImpl.hpp-template MathReceiverComponentImpl.hpp</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;```</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;Add the stub files to `CMakeLists.txt`:</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;```cmake</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;set(SOURCE_FILES</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponent.xml&quot;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  &quot;${CMAKE_CURRENT_LIST_DIR}/MathReceiverComponentImpl.cpp&quot;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;)</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;register_fprime_module()</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;```</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;Add the files and compile them: `fprime-util build`</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;##### 2.4.2.1.1 Port handler</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;Look for the empty port hander in the sub class:</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;```c++</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    mathIn_handler(</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        const NATIVE_INT_TYPE portNum,</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        F32 val1,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        F32 val2,</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        MathOperation operation</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    )</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;  {</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    // TODO</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  }</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;```</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;Fill the handler in with the computation of the result. The handler will also update telemetry and events:</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;```c++</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    mathIn_handler(</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        const NATIVE_INT_TYPE portNum,</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        F32 val1,</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        F32 val2,</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;        MathOperation operation</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    )</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;  {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      // declare result serializable</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      Ref::MathOp op;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      F32 res = 0.0;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      switch (operation) {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;          case MATH_ADD:</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;              op.setop(ADD);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;              res = (val1 + val2)*this-&gt;m_factor1;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;              break;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;          case MATH_SUB:</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;              op.setop(SUB);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;              res = (val1 - val2)*this-&gt;m_factor1;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;              break;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;          case MATH_MULTIPLY:</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;              op.setop(MULT);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;              res = (val1 * val2)*this-&gt;m_factor1;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;              break;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;          case MATH_DIVIDE:</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;              op.setop(DIVIDE);</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;              res = (val1 / val2)*this-&gt;m_factor1;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;              break;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;          default:</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;              FW_ASSERT(0,operation);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;              break;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      }</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      Fw::ParamValid valid;</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      res = res/paramGet_factor2(valid);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      op.setval1(val1);</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      op.setval2(val2);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;      op.setresult(res);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      this-&gt;log_ACTIVITY_HI_MR_OPERATION_PERFORMED(op);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      this-&gt;tlmWrite_MR_OPERATION(op);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      this-&gt;mathOut_out(0,res);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  }</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;```</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;If needed, add `m_factor1` and `m_factor1s` as private variables in `MathReceiverComponentImpl.hpp`:</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;```c++</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;//! Implementation for MR_CLEAR_EVENT_THROTTLE command handler</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;//! Clear the event throttle</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;void MR_CLEAR_EVENT_THROTTLE_cmdHandler(</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    const FwOpcodeType opCode, /*!&lt; The opcode*/</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    const U32 cmdSeq /*!&lt; The command sequence number*/</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;// stored factor1</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;F32 m_factor1;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;// number of times factor1 has been written</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;U32 m_factor1s;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;```</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;In this handler, the operation is done based on the port arguments from `MathSender`. </div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;The `op` structure is populated for the event and telemetry calls, and the `mathOut` port is called to send the result back to `MathSender`. </div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;The parameter value is retrieved during initialization and is returned via the `paramGet_factor2()` call. </div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;The commands to set and save the factor2 parameter run entirely in the code generated base classes.</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;##### 2.4.2.1.2 Commands</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;The command handler to update the value of `factor1` is as follows:</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;```c++</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    MR_SET_FACTOR1_cmdHandler(</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        const FwOpcodeType opCode,</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        const U32 cmdSeq,</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        F32 val</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    )</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;  {</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      this-&gt;m_factor1 = val;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1(val);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;      this-&gt;tlmWrite_MR_FACTOR1(val);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      this-&gt;tlmWrite_MR_FACTOR1S(++this-&gt;m_factor1s);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      // reply with completion status</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;  }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;```</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;The telemetry and log values are sent, and the command response is sent. </div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;Note that after three calls to the handler, the `this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1(val)` call will not actually send any events until the throttle is cleared.</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;The throttled state is part of the generated code.</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;The handler to clear the throttle is as follows:</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;```c++</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    MR_CLEAR_EVENT_THROTTLE_cmdHandler(</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        const FwOpcodeType opCode,</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        const U32 cmdSeq</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    )</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  {</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      // clear throttle</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      this-&gt;log_ACTIVITY_HI_MR_SET_FACTOR1_ThrottleClear();</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      // send event that throttle is cleared</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      this-&gt;log_ACTIVITY_HI_MR_THROTTLE_CLEARED();</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      // reply with completion status</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      this-&gt;cmdResponse_out(opCode,cmdSeq,Fw::COMMAND_OK);</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  }</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;```</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;##### 2.4.2.1.3 Scheduler Call</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;The port invoked by the scheduler retrieves the messages from the message queue and dispatches them. </div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;The message dispatches invoke the command and input port handlers that were implemented earlier in the tutorial.</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;```c++</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    SchedIn_handler(</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        const NATIVE_INT_TYPE portNum,</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        NATIVE_UINT_TYPE context</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    )</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  {</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;      QueuedComponentBase::MsgDispatchStatus stat = QueuedComponentBase::MSG_DISPATCH_OK;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      // empty message queue</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      while (stat != MSG_DISPATCH_EMPTY) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;          stat = this-&gt;doDispatch();</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  }</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;```</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;##### 2.4.2.1.4 Parameter Updates</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;The developer can optionally receive a notification that a parameter has been updated by overriding a virtual function in the code generated base class:</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;```c++ </div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;  void MathReceiverComponentImpl ::</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;     parameterUpdated(</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      FwPrmIdType id /*!&lt; The parameter ID*/</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;  ) {</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      if (id == PARAMID_FACTOR2) {</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        Fw::ParamValid valid;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        F32 val = this-&gt;paramGet_factor2(valid);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        this-&gt;log_ACTIVITY_HI_MR_UPDATED_FACTOR2(val);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  }</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;```</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;Add the function to the header file:</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;```c++</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160; // stored factor1</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  F32 m_factor1;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;  // number of times factor1 has been written</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;  U32 m_factor1s;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  </div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  void parameterUpdated(</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      FwPrmIdType id /*!&lt; The parameter ID*/</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  );</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;```</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;Once it is added, add the directory to the build and build the component by typing `fprime-util build` from the `Ref` directory.</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;#### 2.4.2.2 Unit Tests</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;See section `2.4.1.3.1` for directions on how to generate unit test stubs and copy them to the correct subdirectory. </div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;The `MathReceiver` tests are similar to `MathSender`.</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;##### 2.4.2.2.1 Test Code Implementation</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;The full unit test code for the `MathReceiver` component can be found in the `docs/Tutorials/MathComponent/MathReceiver/test/ut` directory. Many of the patterns are the same. Following are some highlights:</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;##### 2.4.2.2.2 Parameter Initialization</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;`Tester.cpp`, line 60:</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;```c++</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  void Tester ::</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    testAddCommand(void) </div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  {</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;      // load parameters</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;      this-&gt;component.loadParameters();</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      ...</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;```</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;The `loadParameters()` call will attempt to load any parameters that the component needs. </div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;The `this-&gt;paramSet_*` functions in the `*TesterBase` base classes allow the developer to set parameter and status values prior to the `loadParameters()` </div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;With no manually set parameter values preceding the call, in this test case the parameter value is set to the default value. </div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;It is a way to test default settings for parameters.</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;`Tester.cpp`, line 206:</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;```c++</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;  void Tester ::</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    testSubCommand(void) </div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  {</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      // set the test value for the parameter before loading - it will be initialized to this value</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      this-&gt;paramSet_factor2(5.0,Fw::PARAM_VALID);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;      // load parameters</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      this-&gt;component.loadParameters();</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;```</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;In this test case, the parameter value was set prior to the `loadParameters()` call. A `Fw::PARAM_VALID` status is also set, which allows the component consider the value valid and use it.</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;##### 2.4.2.2.3 Serializable Usage</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;`Tester.cpp`, line 78:</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;```c++</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      ...</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      // verify the result of the operation was returned</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      F32 result = (2.0-3.0)*2.0/5.0;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      // the event and telemetry channel use the Ref::MathOp type for values</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      Ref::MathOp checkOp(2.0,3.0,Ref::SUB,result);</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      ...</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;```</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;The `Ref::Mathop` class is the C++ implementation of the serializable type defined in `2.2.1`. When checking event and telemetry histories against the expected values, simply instantiate the serializable class in the test code and use it for comparisons.</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;##### 2.4.2.2.4 Event Throttling</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;`Tester.cpp`, line 395:</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;```c++</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  void Tester ::</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    testThrottle(void) </div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  {</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;```</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;This unit test demonstrates how event throttling works. The event is repeatedly issued until it reaches the throttle count and then is suppressed from then on. The throttle is reset by the `MR_CLEAR_EVENT_THROTTLE` command:</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;`Tester.cpp`, line 446:</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;```c++</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      // send the command to clear the throttle</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;      this-&gt;sendCmd_MR_CLEAR_EVENT_THROTTLE(0,10);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;```</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;# 3 Topology</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;Now that the two components are defined, implemented and unit tested they can to be added to the `Ref` topology. </div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;The topology describes the interconnection of all the components so the system operates as intended. </div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;They consist of the core Command and Data Handling (C&amp;DH) components that are part of the reusable set of components that come with the F´ repository as well as custom components written for the `Ref` reference example including the ones in this tutorial. </div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;The `Ref` topology has already been developed as an example. </div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;The tutorial will add the `MathSender` and `MathReceiver` components to the existing demonstration. </div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;It involves modification of a topology description XML file as well as accompanying C++ code to instantiate and initialize the components.</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;## 3.1 Define C++ Component Instances</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;The first step is to include the implementation files in the topology source code.</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;### 3.1.1 Components.hpp</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;There is a C++ header file that declares all the component instances as externals for use by the initialization code and the generated code that interconnects the components. The two new components can be added to this file. First, include the header files for the implementation classes:</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;`Ref/Top/Components.hpp`, line 30:</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;```c++</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;#include &lt;Drv/BlockDriver/BlockDriverImpl.hpp&gt;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;#include &lt;Ref/MathSender/MathSenderComponentImpl.hpp&gt;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;#include &lt;Ref/MathReceiver/MathReceiverComponentImpl.hpp&gt;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;```</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;`extern` declarations need to be made in this header file for use by the topology connection file that is discussed later as well as initialization code.</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;`Ref/Top/Components.hpp`, line 61:</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;```c++</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;extern Ref::PingReceiverComponentImpl pingRcvr;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;extern Ref::MathSenderComponentImpl mathSender;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;extern Ref::MathReceiverComponentImpl mathReceiver;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;```</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;### 3.1.2 Topology.cpp</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;This C++ file is where the instances of the all the components are declared and initialized. The generated topology connection function is called from this file.</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;#### 3.1.2.1 Component Instantiation</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;Put these declarations after the declarations for the other `Ref` components:</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;`Ref/Top/Topology.cpp`, line 187:</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;```c++</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;Ref::MathSenderComponentImpl mathSender(FW_OPTIONAL_NAME(&quot;mathSender&quot;));</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;Ref::MathReceiverComponentImpl mathReceiver(FW_OPTIONAL_NAME(&quot;mathReceiver&quot;));</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;```</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;Where the other components are initialzed, add `MathSender` and `MathReceiver`:</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;`Ref/Top/Topology.cpp`, line 286:</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;```c++</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   pingRcvr.init(10);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    mathSender.init(10,0);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    mathReceiver.init(10,0);</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;```</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;The first argument is the queue message depth. </div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;This is the number of messages that can be pending while other messages are being dispatched. </div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;After all the components are initialized, the generated function `constructRefArchitecture()` (see `RefTopologyAppAc.cpp`) can be called to connect the components together. How this function is generated will be seen later in the tutorial.</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;`Ref/Top/Topology.cpp`, line 291:</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;```c++</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    // call generated function to connect components</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    constructRefArchitecture();</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;```</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;Next, the components commands are registered.</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;`Ref/Top/Topology.cpp`, line 308:</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;```c++</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    health.regCommands();</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    pingRcvr.regCommands();</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    mathSender.regCommands();</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    mathReceiver.regCommands();</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;```</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;Component parameters are retrieved from disk by `prmDb` prior to the components requesting them:</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;`Ref/Top/Topology.cpp`, line 314:</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;```c++</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    // read parameters</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    prmDb.readParamFile();</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;```</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;Once the parameters are read by `prmDb`, the components can request them:</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;`Ref/Top/Topology.cpp`, line 300:</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;```c++</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    sendBuffComp.loadParameters();</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    mathReceiver.loadParameters();</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;```</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;The thread for the active `MathSender` component needs to be started:</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;`Ref/Top/Topology.cpp`, line 357:</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;```c++</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    pingRcvr.start(0, 100, 10*1024);</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    mathSender.start(0,100,10*1024);</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;```</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;The arguments to the `start()` function is as follows:</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;|Argument|Usage|</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;|---|---|</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;|1|Thread ID, unique value for each thread. Not used for Linux|</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;|2|Thread priority. Passed to underlying OS|</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;|3|Thread stack size. Passed to underlying OS|</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;The `MathReceiver` queued component will execute on the thread of the 1Hz rate group, which will be shown later. </div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;It does not need to to have a thread started, since queued components do not have threads.</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;The `exitTasks()` function is called when the process is shut down. </div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;It contains `exit()` calls to all the active components. </div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;These functions internally send a message to the component&#39;s thread to shut down.</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;`Ref/Top/Topology.cpp`, line 396:</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;```c++</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    cmdSeq.exit();</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    mathSender.exit();</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;```</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;## 3.2 Define Component Connections</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;Components need to be connected to invoke each other via ports. </div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;The connections are specified via a topology XML file. </div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;The file for the Ref example is located in `Ref/Top/RefTopologyAppAi.xml` </div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;The connections for the new components will be added to the existing connections.</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;### 3.2.1 Component Imports</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;The component XML definitions must be imported into the topology file:</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 32:</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;```xml</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;   &lt;import_component_type&gt;Svc/PassiveTextLogger/PassiveTextLoggerComponentAi.xml&lt;/import_component_type&gt;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    &lt;import_component_type&gt;Ref/MathSender/MathSenderComponentAi.xml&lt;/import_component_type&gt;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    &lt;import_component_type&gt;Ref/MathReceiver/MathReceiverComponentAi.xml&lt;/import_component_type&gt;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;```</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;### 3.2.2 Component Instances</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;The Component instances must be declared.</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 92:</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;```xml</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;   &lt;instance namespace=&quot;Svc&quot; name=&quot;textLogger&quot; type=&quot;PassiveTextLogger&quot; base_id=&quot;521&quot;  base_id_window=&quot;20&quot; /&gt;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;   &lt;instance namespace=&quot;Ref&quot; name=&quot;mathSender&quot; type=&quot;MathSender&quot; base_id=&quot;1000&quot;  base_id_window=&quot;20&quot; /&gt;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;   &lt;instance namespace=&quot;Ref&quot; name=&quot;mathReceiver&quot; type=&quot;MathReceiver&quot; base_id=&quot;1100&quot;  base_id_window=&quot;20&quot; /&gt;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;```</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;The name in the `name=` attribute must match the one declared previously in `Ref/Top/Components.hpp`. For example:</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;```c++</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;extern Ref::MathSenderComponentImpl mathSender;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;```</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;The type must match the type declared in the component XML:</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;`Ref/MathSender/MathSenderComponentAi.xml`:</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;```xml</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;&lt;component name=&quot;MathSender&quot; kind=&quot;active&quot; namespace=&quot;Ref&quot;&gt;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;```</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;The `base_id` attribute specifies the beginning range of the assigned IDs for commands, telemetry, events, and parameters. </div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;The values declared in the component XML are added to this base address. </div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;This allows multiple instances of components to be declared with unique ID ranges. </div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;The `base_id_window` attribute is used to set a limit on ID ranges for spacing the base IDs from different components sufficiently apart. </div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;If the IDs exceed the limit, the code generator will issue a warning.</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;### 3.2.3 Command connections</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;The command connections should follow these rules:</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;1. The port number of the command registration port on the `cmdDisp` component connection from the commanded components must be unique for all components.</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;2. The port number of the command dispatch port connection from the `cmdDisp` component to the commanded component must match the registration port number.</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;3. The command status from the components can go to port 0 of the command status port of the `cmdDisp` component.</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;The following XML shows the command connection for the tutorial components.</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;The port number used for the registration and dispatch ports is selected as 20,</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;a unique number that hasn&#39;t been used yet in the `Ref` example.</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 817:</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;```xml</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;   &lt;!-- Command Registration Ports - Registration port number must match dispatch port for each component --&gt;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;   &lt;connection name = &quot;MathSenderReg&quot;&gt;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        &lt;source component = &quot;mathSender&quot; port = &quot;CmdReg&quot; type = &quot;CmdReg&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        &lt;target component = &quot;cmdDisp&quot; port = &quot;compCmdReg&quot; type = &quot;CmdReg&quot; num = &quot;20&quot;/&gt;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;   &lt;connection name = &quot;MathReceiverReg&quot;&gt;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;        &lt;source component = &quot;mathReceiver&quot; port = &quot;CmdReg&quot; type = &quot;CmdReg&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        &lt;target component = &quot;cmdDisp&quot; port = &quot;compCmdReg&quot; type = &quot;CmdReg&quot; num = &quot;21&quot;/&gt;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;   </div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    &lt;!-- Command Dispatch Ports - Dispatch port number must match registration port for each component --&gt;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;   &lt;connection name = &quot;MathSenderDisp&quot;&gt;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        &lt;source component = &quot;cmdDisp&quot; port = &quot;compCmdSend&quot; type = &quot;Cmd&quot; num = &quot;20&quot;/&gt;</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        &lt;target component = &quot;mathSender&quot; port = &quot;CmdDisp&quot; type = &quot;Cmd&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;   &lt;connection name = &quot;MathReceiverDisp&quot;&gt;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        &lt;source component = &quot;cmdDisp&quot; port = &quot;compCmdSend&quot; type = &quot;Cmd&quot; num = &quot;21&quot;/&gt;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        &lt;target component = &quot;mathReceiver&quot; port = &quot;CmdDisp&quot; type = &quot;Cmd&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;   </div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    &lt;!-- Command Reply Ports - Go to the same response port on the dispatcher --&gt;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;   &lt;connection name = &quot;MathSenderReply&quot;&gt;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      &lt;source component = &quot;mathSender&quot; port = &quot;CmdStatus&quot; type = &quot;CmdResponse&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      &lt;target component = &quot;cmdDisp&quot; port = &quot;compCmdStat&quot; type = &quot;CmdResponse&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;   &lt;connection name = &quot;MathReceiverReply&quot;&gt;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      &lt;source component = &quot;mathReceiver&quot; port = &quot;CmdStatus&quot; type = &quot;CmdResponse&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      &lt;target component = &quot;cmdDisp&quot; port = &quot;compCmdStat&quot; type = &quot;CmdResponse&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;```</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;### 3.2.4 Event Connections</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;The output connections for log ports are connected to the `eventLogger` component.</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 845:</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;```xml</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;   &lt;!-- Event Logger Binary Connections --&gt;</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;   </div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;   &lt;connection name = &quot;MathSenderLog&quot;&gt;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;       &lt;source component = &quot;mathSender&quot; port = &quot;Log&quot; type = &quot;Log&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        &lt;target component = &quot;eventLogger&quot; port = &quot;LogRecv&quot; type = &quot;Log&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;   &lt;connection name = &quot;MathReceiverLog&quot;&gt;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;Log&quot; type = &quot;Log&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        &lt;target component = &quot;eventLogger&quot; port = &quot;LogRecv&quot; type = &quot;Log&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;   &lt;!-- Event Logger Text Connections --&gt;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;   </div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;   &lt;connection name = &quot;MathSenderTextLog&quot;&gt;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;       &lt;source component = &quot;mathSender&quot; port = &quot;LogText&quot; type = &quot;LogText&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;        &lt;target component = &quot;textLogger&quot; port = &quot;TextLogger&quot; type = &quot;LogText&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;   &lt;connection name = &quot;MathReceiverTextLog&quot;&gt;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;LogText&quot; type = &quot;LogText&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        &lt;target component = &quot;textLogger&quot; port = &quot;TextLogger&quot; type = &quot;LogText&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;```</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;There are two kinds of connections for logging: One for a binary form that will be sent to the ground system, and a text version for displaying on standard output of the target machine.</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;### 3.2.5 Telemetry Connections</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;The telemetry output ports are connected to the `chanTlm` component.</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 872:</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;```xml</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;   &lt;!-- Telemetry Connections --&gt;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;   &lt;connection name = &quot;MathSenderTextTlm&quot;&gt;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;       &lt;source component = &quot;mathSender&quot; port = &quot;Tlm&quot; type = &quot;Tlm&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        &lt;target component = &quot;chanTlm&quot; port = &quot;TlmRecv&quot; type = &quot;Tlm&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;   &lt;connection name = &quot;MathReceiverTextTlm&quot;&gt;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;Tlm&quot; type = &quot;Tlm&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        &lt;target component = &quot;chanTlm&quot; port = &quot;TlmRecv&quot; type = &quot;Tlm&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;   </div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;```</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;### 3.2.6 Parameter Connections</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;There are two parameter connections, a `PrmGet` connection for reading parameters during software initialization and a `PrmSet` for updating parameters in the component that manages parameter values. F&#39; has a basic parameter storage component `prmDb` that stores parameters in files. Upon bootup, they are read from a file specified in the constructor and stored in memory. Subsequent to this, components request their parameters via the `PrmGet` connection. If they are updated by command, they can be saved to storage by issuing a command to call the `PrmSet` with the new value and issuing the `PRM_SAVE_FILE` command.</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 883:</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;```xml</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;   &lt;!-- Parameter Connections --&gt;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;   </div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;   &lt;connection name = &quot;MathReceiverPrmGet&quot;&gt;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;ParamGet&quot; type = &quot;PrmGet&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        &lt;target component = &quot;prmDb&quot; port = &quot;getPrm&quot; type = &quot;PrmGet&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;   &lt;connection name = &quot;MathReceiverPrmSet&quot;&gt;</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;ParamSet&quot; type = &quot;PrmSet&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        &lt;target component = &quot;prmDb&quot; port = &quot;setPrm&quot; type = &quot;PrmSet&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;```</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;### 3.2.7 Time Connections</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;Components that have telemetry or events need to be able to time stamp the events. The time connections connect the components to a time source to provide the time stamps.</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 894:</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;```xml</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;   &lt;!-- Time Connections --&gt;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;   &lt;connection name = &quot;MathSenderTime&quot;&gt;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;       &lt;source component = &quot;mathSender&quot; port = &quot;Time&quot; type = &quot;Time&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        &lt;target component = &quot;linuxTime&quot; port = &quot;timeGetPort&quot; type = &quot;Time&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;   &lt;connection name = &quot;MathReceiverTime&quot;&gt;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;Time&quot; type = &quot;Time&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        &lt;target component = &quot;linuxTime&quot; port = &quot;timeGetPort&quot; type = &quot;Time&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;```</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;### 3.2.8 Scheduler Connection</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;The `MathReceiver` component does not have a thread of its own, but relies on the thread of another component to drive it via the `SchedIn` port. The `SchedIn` port is connected to the 1Hz rate group component that is part of the `Ref` example. This means that every second the component gets a call and can unload messages from its message queue and dispatch them to handlers.</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 894:</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;```xml</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;   &lt;!-- Scheduler Connection --&gt;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    &lt;connection name = &quot;MathReceiverRG&quot;&gt;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;         &lt;source component = &quot;rateGroup1Comp&quot; port = &quot;RateGroupMemberOut&quot; type = &quot;Sched&quot; num = &quot;3&quot;/&gt;</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;         &lt;target component = &quot;mathReceiver&quot; port = &quot;SchedIn&quot; type = &quot;Sched&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    &lt;/connection&gt;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;```</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;### 3.2.9 The Math Operation Connection</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;The final connection is the connection that performs the math operation. It goes from `MathSender` to `MathReceiver`.</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;`Ref/Top/RefTopologyAppAi.xml`, line 911:</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;```xml</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;   &lt;!-- Math Connection --&gt;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;   &lt;connection name = &quot;MathOpConnection&quot;&gt;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;       &lt;source component = &quot;mathSender&quot; port = &quot;mathOut&quot; type = &quot;Ref::MathOp&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;        &lt;target component = &quot;mathReceiver&quot; port = &quot;mathIn&quot; type = &quot;Ref::MathOp&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;   &lt;connection name = &quot;MathResultConnection&quot;&gt;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;       &lt;source component = &quot;mathReceiver&quot; port = &quot;mathOut&quot; type = &quot;Ref::MathResult&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        &lt;target component = &quot;mathSender&quot; port = &quot;mathIn&quot; type = &quot;Ref::MathResult&quot; num = &quot;0&quot;/&gt;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   &lt;/connection&gt;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   </div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;```</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;Once all the updates to the topology file have been made, the module can be built by typing `fprime-util build` at the command line in the `Ref/Top` directory. </div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;If the updates were correct, the module should compile with no errors. </div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;The overall `Ref` deployment can be built by changing to the `Ref` directory and typing `fprime-util build`. Once the</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;build passes, you should also run the installation of the `Ref` deployment using by typing `fprime-util install`.</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;If running on a different platform, you can specify the build target by typing `fprime-util generate &lt;target&gt;`.</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;# 4 Executing the Example</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;We are now ready to run the ground system. Before the user runs this build system, ensure that the install command has</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;been run. This is accomplished with the following commands:</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;```shell</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;cd fprime/Ref</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;fprime-util install</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;```</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;## 4.1 Running the Ground System</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;Once the `Ref` example has successfully built, the ground system and executable can be run by typing `fprime-gds -d fprime/Ref`. The ground system GUI should appear:</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;### 4.1.1 Executing Commands</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;Commands can be executed by selecting the `Commands` tab and clicking on the `Cmds` drop-down list. </div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;For the tutorial example, select the `MathSender` command `MS_DO_MATH` and fill in the arguments.</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;Clicking on the `Send` button will send the command to the software. When the command is sent, it is placed in the command history. It can be selected and sent again if the user desires.</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;### 4.1.2 Checking Events</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;The `Events` tab shows events that are generated by the software. For the tutorial, the events tab shows the events that were sent by the `MS_DO_MATH` command:</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;It shows the F&#39; `CmdDispatcher` event indicating a command was dispatched and completed. It also has the events defined by the tutorial example that are sent as a results of requesting a math operation. The result is zero, since the `factor1` value is zero, as shown in the unit testing in section `2.4.2.2`.</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;The events are also echoed to `stdout` of the application, which can be found in the `Logs` tab, selecting &quot;Ref.log&quot; in the</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;dropdown.</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;### 4.1.3 Checking Telemetry</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;The `Channel Telemetry` tab shows channelized telemetry sent by the software. The channels defined by the tutorial have the last values and time they were updated:</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;### 4.1.5 Updating `factor1`</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;In order to get a non-zero result, `factor1` needs to be updated. The tutorial defined a command to update it, `MR_SET_FACTOR1`. It can be selected from the command tab:</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;When the command is executed, the `Log Events` tab will show the event indicating the value was updated.</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;The `Channel Telemetry` tab shows the two channels related to the update. `MR_FACTOR1` shows the new value, while `MR_FACTOR1S` show how many times the value has been updated.</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;### 4.1.6 Running the Command Again</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;After `factor1` has been updated, the command can be repeated:</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;### 4.1.7 Updated Events and Telemetry</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;The new events will appear in the `Log Events` tab:</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;Notice that the updated events are added to the end of the log, since events are meant to be a record of events in the software.</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;The `Channel Telemetry` tab will also show the updated values:</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;Notice that the `MS_OP`, `MS_VAL1`, `MS_VAL2`, `MR_OPERATION`, and `MS_RESULT` are updated to the latest value with a more recent time stamp, since telemetry channels are meant to show the latest value. The new result is `10.0` now that `factor1` has been updated.</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;### 4.1.8 Parameter Updates</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;The tutorial defined a `factor2` parameter in the `MathReceiver` component. The code generator creates two commands for each parameter: `XXXX_PRM_SET` and `XXX_PRM_SAVE` where `XXX` is an upper case version of the parameter name. The `FACTOR2_PRM_SET` command will set the value in `MathReceiver`, while `FACTOR2_PRM_SAVE` will send the current value to `PrmDb` for storage. `PrmDb` is an F&#39; infrastructure component that reads and writes parameters to storage. It is important to note that `PrmDb` does not immediately write the value to storage. There is an explicit `PRM_SAVE_FILE` command that will take all the parameter values currently in RAM and write them. </div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;#### 4.1.8.1 Setting the Parameter Value</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;The `FACTOR1_PRM_SET` command can be sent to the software:</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;The notification function that was implemented as part of the tutorial will send an event indicating the value was updated:</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;The `MS_DO_MATH` command can now be executed with the new value:</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;The `MathReceiver` component sends the events with the new result:</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;The new result is `1.0` with the new value of `factor2`. The &quot;Channel Telemetry&quot; tab also shows the new values:</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;#### 4.1.8.2 Saving the Parameter Value</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;Once the parameter value has been tested to the user&#39;s satisfaction, it can be saved to `PrmDb` by sending the `FACTOR2_PRM_SAVE` command:</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;The `Log Events` tab has an event from `PrmDb` indicating that the `FACTOR2` parameter value was added:</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;#### 4.1.8.3 Writing the Parameter to Storage</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;The parameter can be written to storage by sending the `PRM_SAVE_FILE` command:</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;`PrmDb` sends an event indicating that the parameters in RAM were stored:</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;### 4.1.9 Ground System Logs</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;The ground system keeps logs of all received events and telemetry. They can be found in the directories `&lt;deployment&gt;/logs/`, where `&lt;Run Directory&gt;` is the location of the deployment. e.g. `Ref`.</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;# Conclusion</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;This tutorial is an attempt to communicate the concepts and implementation. If there are aspects that are confusing,</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;feel free to submit GitHub issues asking for clarification or to report errors:</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;https://github.com/nasa/fprime/issues</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_math_component_2_tutorial_8md.html">Tutorial.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
